# Sistema de Liquidaci√≥n de N√≥mina - Gu√≠a T√©cnica

## Autores

- Santiago Alcaraz Durango
- Luis Carlos Guerra Herrera

## üåê Sitio Web 
- [Acceder al Sistema de N√≥mina](https://liquidador-de-nomina-1.onrender.com)
  
## Autores
- Miguel √Ångel Guarnizo.
- David Hernandez Mejia.

## Ejecuci√≥n de la aplicaci√≥n web üåê
1. Desde la ra√≠z del proyecto, ejecuta el siguiente comand
```
  python app.py
```
2. Ver√°s en consola un mensaje de confirmaci√≥n similar al siguiente:
```
  - Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
  - Restarting with stat
  - Debugger is active!
  - Debugger PIN: XXX-XXX-XXX
```
3. Accedes por medio del http generado arriba.
4. Antes que nada dar click en "crear tablas" para crear las respectivas tablas en la base de datos  
## Instalaci√≥n

### Instalaci√≥n de Kivy

Hay dos formas de instalar Kivy:

1. **Instalaci√≥n global:**
```
C:\AppData\Local\Programs\Python\Python313\python.exe -m pip install kivy[base] kivy_examples
```

2. **Instalaci√≥n con entorno virtual (recomendado):**
```
python -m venv venv
.\venv\Scripts\activate
pip install kivy
```

## Descripci√≥n General

### Prop√≥sito del sistema:
El sistema tiene como objetivo realizar la liquidaci√≥n de salarios, bonificaciones, deducciones y novedades seg√∫n la normativa laboral colombiana. Abarca el c√°lculo de salarios base, auxilio de transporte, horas extras, pr√©stamos y otras deducciones, generando reportes detallados para cumplir con las obligaciones legales y laborales.

### Alcance:
El sistema cubre las siguientes √°reas:
- C√°lculo de variables salariales.
- Gesti√≥n de novedades legales (horas extras).
- C√°lculo de pr√©stamos y deducciones legales.
- Generaci√≥n de reportes (PDF, Excel) con el desglose de salarios y cumplimiento de las normativas colombianas.


## Variables de Entrada

### Datos Base del Empleado:
1. **salario_base** (num√©rico, var√≠a por cargo): Salario mensual base del empleado.
2. **auxilio_transporte** (num√©rico, seg√∫n ley vigente): Auxilio de transporte, determinado por la ley actual.
3. **cargo** (texto, determina salario y bonificaciones): Cargo o puesto del empleado, utilizado para determinar su salario base y bonificaciones.

### Agenda y Novedades:
1. **horarios** (lista de d√≠as/horas laborales): Informaci√≥n de los d√≠as y horas laborales del empleado.
3. **horas_extras** (cantidad y tipo: diurnas/nocturnas/festivas): Detalles de horas extras trabajadas, clasificados seg√∫n el tipo (diurnas, nocturnas, festivas).

### Deducciones:
1. **prestamos** (monto, cuotas, tasa de inter√©s 6%): Pr√©stamos del empleado, indicando el monto, el n√∫mero de cuotas y la tasa de inter√©s (6% anual).



## Variables de Salida

1. **salario_neto**: Salario del empleado despu√©s de aplicar las deducciones y bonos.
2. **desglose_pago**: Detalle de las horas extras, bonos, auxilio de transporte y deducciones.
3. **reporte_legal**: Reporte con el cumplimiento de las normativas laborales en el c√°lculo de la liquidaci√≥n.



## F√≥rmulas y C√°lculos

### D√≠a de Trabajo:
Para calcular el valor de un d√≠a de trabajo:

$$
\text{valor dia} = \frac{\text{salario base}}{30}
$$



## Incapacidad y Calamidad

### Salario por incapacidad:
Para calcular el salario por incapacidad:

$$
\text{salario} = \text{d√≠as de incapacidad} \times \text{valor dia}
$$

## Pr√©stamos

### C√°lculo de cuota mensual

```math
cuota\_mensual = \frac{monto\_prestamo \times (1 + 0.06)}{cuotas\_restantes}
```

Esto permite calcular la cuota mensual a descontar del salario, considerando el inter√©s del 6% anual.

## Horas Extras

### Para calcular el pago por horas extras:

#### Diurnas
```math
valor\_hora\_extra = valor\_hora \times 1.25
```

#### Nocturnas
```math
valor\_hora\_extra = valor\_hora \times 1.75
```

#### Festivas
```math
valor\_hora\_extra = valor\_hora \times 2.5
```

### C√°lculo del valor de la hora
```math
valor\_hora = \frac{salario\_base}{240}
```
Esto supone una jornada de 8 horas diarias y 30 d√≠as laborales al mes.

## Fondo de Solidaridad Pensional (FSP)

El **Fondo de Solidaridad Pensional (FSP)** es una deducci√≥n aplicada a trabajadores con ingresos superiores a un umbral establecido por ley, destinada a subsidiar pensiones de personas con menores ingresos. Su c√°lculo se rige por el **Estatuto Tributario (Ley 1819 de 2016)** y se actualiza anualmente seg√∫n la **Unidad de Valor Tributario (UVT)**.  

A continuaci√≥n, te explicamos c√≥mo se calcula el FSP en 2025:

---

###  Umbrales y porcentajes

| **Rango de ingresos**       | **Porcentaje de deducci√≥n**  |
|-----------------------------|----------------------------:|
| M√°s de 4 UVT hasta 16 UVT   | 1% sobre el excedente       |
| M√°s de 16 UVT               | 2% sobre el excedente       |

---

### Pasos para calcular el FSP en 2025

#### 1. Obtener el valor de la UVT 2025  
- La **UVT** se ajusta anualmente seg√∫n el **√çndice de Precios al Consumidor (IPC)**.  
- En **2025**, 1 UVT = **$49,799 COP** *(ejemplo ilustrativo; para 2025, consulta el valor oficial en el **DIAN**).*
- **Ejemplo hipot√©tico:** Supongamos que en **2025**, **1 UVT = $49,700 COP**.

---

#### 2. Calcular los umbrales en pesos  
- **4 UVT** = 4 √ó 49,700 = **198,800 COP**  
- **16 UVT** = 16 √ó 49,700 = **795,200 COP**  

---

#### 3. Aplicar los porcentajes seg√∫n el salario  
Si el salario es **$1,000,000 COP** *(ejemplo):*
- **Excedente sobre 4 UVT:**  
  1,000,000 - 198,800  = **$801,200**  
- **Excedente sobre 16 UVT:**  
  1,000,000 - 795,200 = **$204,800**  

---

### C√°lculo del FSP  
- **1% sobre (801,200 - 204,800):**  
  596,400 √ó 1% = **5,964 COP**  
- **2% sobre (204,800):**  
  204,800 √ó 2% = **4,096 COP**  

** Total FSP: 5,964 + 4,096 = $10,060 COP**  


## Especificaciones T√©cnicas

### Validaci√≥n de Datos

- El sistema debe validar que los tipos de novedades sean correctos (por ejemplo, no se permiten ingresar horas extras negativas).
- Validaci√≥n de sobre el tipo de horas extras y cargos

### Persistencia

- El sistema debe almacenar el historial de las liquidaciones por un periodo, seg√∫n la Ley 527 de 1999.

### Interfaces

- El sistema debe ofrecer una interfaz grafica web.


  
## Ejemplo de Caso de Uso

**Empleado con las siguientes caracter√≠sticas:**
- Salario base: $3,000,000
- Auxilio de transporte: $140,000
- 2 d√≠as de incapacidad
- 1 pr√©stamo de $1,000,000 con 6% de inter√©s y 12 cuotas
- 5 horas extras diurnas

### C√°lculo paso a paso

#### Valor del d√≠a
```math
valor\_d√≠a = \frac{salario\_base}{30} = \frac{3,000,000}{30} = 100,000
```

#### Salario por incapacidad (2 d√≠as)
```math
salario\_incapacidad = d√≠as\_incapacidad \times valor\_d√≠a = 2 \times 100,000 = 200,000
```

#### Deducci√≥n por auxilio de transporte durante la incapacidad
```math
deducci√≥n\_auxilio = \frac{auxilio\_transporte}{30} \times d√≠as\_incapacidad = \frac{140,000}{30} \times 2 = 9,333.33
```

#### Cuota mensual de pr√©stamo
```math
cuota\_mensual = \frac{monto\_prestamo \times (1 + 0.06)}{cuotas\_restantes} = \frac{1,000,000 \times 1.06}{12} = 88,333.33
```

#### Horas extras diurnas (5 horas)
```math
valor\_hora = \frac{salario\\_base}{240} = \frac{3,000,000}{240} = 12,500
```
```math
valor\_hora\_extra = valor\_hora \times 1.25 = 12,500 \times 1.25 = 15,625
```
```math
total\_horas\_extras = 5 \times 15,625 = 78,125
```

#### Salario neto
```math
salario\_neto = 3,000,000 - 200,000 - 9,333.33 - 88,333.33 + 78,125 = 2,780,458.34
```



## Documentaci√≥n para la ejecuci√≥n del programa y pruebas unitarias

### Pasos para ejecutar el programa `main.py` desde la terminal de Windows:

1. **Abrir la terminal de Windows**:
  - Presiona `Win + R`, escribe `cmd` y presiona `Enter`.

2. **Navegar al directorio del proyecto**:
  - Utiliza el comando `cd` para cambiar al directorio donde se encuentra el archivo `main.py`. Por ejemplo:
    ```sh
    cd d:\Documentos\Programaci√≥n\Proyectos\Liquidador-de-Nomina
    ```

3. **Ejecutar el programa**:
  - Una vez en el directorio correcto, ejecuta el programa con el siguiente comando:
    ```
    python src/view/console/main.py
    ```

### Pasos para ejecutar las pruebas unitarias `test_nomina.py`:

1. **Abrir la terminal de Windows**:
  - Presiona `Win + R`, escribe `cmd` y presiona `Enter`.

2. **Navegar al directorio del proyecto**:
  - Utiliza el comando `cd` para cambiar al directorio donde se encuentra el archivo `test_nomina.py`. Por ejemplo:
    ```sh
    cd d:\Documentos\Programaci√≥n\Proyectos Pycharm\Liquidador de Nomina\Liquidador-de-Nomina
    ```

3. **Ejecutar las pruebas unitarias**:
  - Aseg√∫rate de tener `unittest` disponible. Es parte de la biblioteca est√°ndar de Python, por lo que no necesitas instalar nada adicional.
  - Una vez en el directorio correcto, ejecuta las pruebas unitarias con el siguiente comando:
    ```sh
    python test/test_nomina.py
    ```
  - `unittest` buscar√° y ejecutar√° las pruebas definidas en `test_nomina.py` y mostrar√° los resultados en la terminal.


## Arquitectura del Proyecto

El proyecto est√° organizado en una estructura de carpetas que facilita la separaci√≥n de responsabilidades y la mantenibilidad del c√≥digo. A continuaci√≥n se describe la organizaci√≥n de los m√≥dulos y las bibliotecas utilizadas:

#### Estructura de Carpetas

```
Liquidador-de-Nomina/
|
‚îú‚îÄ‚îÄ assets
‚îÇ   ‚îú‚îÄ‚îÄ img
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logo_nomina.ico
‚îÇ   ‚îî‚îÄ‚îÄ sql
‚îÇ       ‚îî‚îÄ‚îÄ DML-LiquidadorNomina.png
‚îú‚îÄ‚îÄ dist
‚îÇ   ‚îî‚îÄ‚îÄ SistemaNomina.exe
‚îú‚îÄ‚îÄ sql
‚îÇ   ‚îú‚îÄ‚îÄ borrar_empleados.sql
‚îÇ   ‚îú‚îÄ‚îÄ insertar_cargos.sql
‚îÇ   ‚îú‚îÄ‚îÄ insertar_tipo_de_horas_extra.sql
‚îÇ   ‚îú‚îÄ‚îÄ tabla_cargos.sql
‚îÇ   ‚îú‚îÄ‚îÄ tabla_empleados.sql
‚îÇ   ‚îú‚îÄ‚îÄ tabla_horas_extra.sql
‚îÇ   ‚îú‚îÄ‚îÄ tabla_prestamo.sql
‚îÇ   ‚îî‚îÄ‚îÄ tabla_tipo_hora_extra.sql
‚îú‚îÄ‚îÄ src
‚îÇ   ‚îú‚îÄ‚îÄ controller
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cargos_controller.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ nomina_controller.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tipo_hora_extra_controller.py
‚îÇ   ‚îú‚îÄ‚îÄ model
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ calculo_nomina.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ clase_empleado.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ excepciones.py
‚îÇ   ‚îú‚îÄ‚îÄ view
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GUI
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ borrar_screen.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ calcular_screen.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ consultar_screen.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main_screen.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ modificar_screen.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ console
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.py
‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ web 
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ templates
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ panel.html
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ registrar.html
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ plano.py
‚îú‚îÄ‚îÄ test
‚îÇ   ‚îú‚îÄ‚îÄ test_nomina.py
‚îÇ   ‚îî‚îÄ‚îÄ test_nomina_DB.py
‚îú‚îÄ‚îÄ LICENSE.txt
‚îú‚îÄ‚îÄ Liquidador-de-N√≥mina.xlsx
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ SecretConfig.py
‚îú‚îÄ‚îÄ SistemaNomina.spec
‚îú‚îÄ‚îÄ pyproject.toml
‚îî‚îÄ‚îÄ requirements.txt

```

#### Descripci√≥n de Carpetas y Archivos

- **src/**: Contiene el c√≥digo fuente del proyecto.
  - **model/**: Incluye la l√≥gica de negocio y las clases principales.
    - `calculo_nomina.py`: Contiene la clase `Nomina` y las funciones para calcular el salario, horas extras, bonificaciones, etc.
    - `excepciones.py`: Define las excepciones personalizadas utilizadas en el proyecto.
  - **view/**: Contiene las interfaces de usuario.
    - **console/**: Incluye la interfaz de consola para interactuar con el usuario.
      - `main.py`: Implementa la l√≥gica de la consola para la entrada y salida de datos.
- **test/**: Contiene las pruebas unitarias.
  - `test_nomina.py`: Incluye las pruebas unitarias para la clase `Nomina` y sus m√©todos.
- `README.md`: Documentaci√≥n del proyecto.
- `requirements.txt`: Lista de dependencias y bibliotecas necesarias para ejecutar el proyecto.

### Bibliotecas Usadas

- **unittest**: Biblioteca est√°ndar de Python para realizar pruebas unitarias.
- **sys**: Biblioteca est√°ndar de Python para manipular el entorno de ejecuci√≥n.

### Dependencias

El proyecto no tiene dependencias externas adicionales a las bibliotecas est√°ndar de Python. Todas las funcionalidades se implementan utilizando las bibliotecas est√°ndar y el c√≥digo propio del proyecto(por el momento).

### Organizaci√≥n de M√≥dulos

- **model**: Contiene la l√≥gica y las clases.
- **view**: Contiene las interfaces de usuario, en este caso, una interfaz de consola.
- **test**: Contiene las pruebas unitarias para asegurar la calidad del c√≥digo.

Esta organizaci√≥n modular permite una f√°cil extensi√≥n y mantenimiento del proyecto, asegurando que cada componente tenga una responsabilidad clara y definida.


Perfecto, entonces actualizo el `README.md` para que la instrucci√≥n de ejecuci√≥n sea clara con la nueva ruta del archivo principal (`src/view/console/GUI.py`). Aqu√≠ tienes la versi√≥n actualizada:

---

# Liquidador de N√≥mina (Kivy)

Aplicaci√≥n gr√°fica desarrollada en **Python + Kivy** para calcular la n√≥mina de un empleado seg√∫n diferentes par√°metros como salario base, horas extras, tipo de hora, pr√©stamos, cuotas e intereses.

---

## Requisitos

- Python 3.7 o superior
- Kivy (`pip install kivy`)
  
## Requisitos web
-  flask == 3.1.1
-  Werkzeug == 3.1.3
-  psycopg2==2.9.10
---

## Instrucciones para ejecutar

1. **Clona o descarga el proyecto**

2. **Instala las dependencias**

```bash
pip install kivy
```

3. **Ejecuta la aplicaci√≥n**

- Desde la ra√≠z del proyecto, corre:

```bash
python src/view/GUI/GUI.py
```

---
- Desde la carpeta raiz del proyecto tambien puede ejecutar GUI.exe en la ruta dist\GUI


## Autores interfaz

- Mileidy Vanegas
- Miguel Mart√≠nez
---
# Liquidador de N√≥mina (interfaz gr√°fica + base de datos)

## **Prerrequisitos**

### **Dependencias**
- Kivy
  -  Instale el paquete con:
  ```bash
  pip install kivy
  ```
- psycopg2
  - Instale el paquete psycopg2 con:
  ```bash
  pip install psycopg2
  ```

### **Configuracion de la base de datos**
    
1. **Crear la Base de Datos**
  - En el gestor de base de datos de su elecci√≥n, haz clic derecho en "Bases de datos"
  - Selecciona "Crear" ‚Üí "Base de datos"
  - Nombra la base de datos como "nomina"
  - Haz clic en "Guardar"
    
2. **Configurar el Archivo de Conexi√≥n**
  - Crea un archivo llamado SecretConfig.py en la carpeta principal del proyecto
  - Dentro del archivo escribe los siguientes datos:
```python
     PGDATABASE = "nomina"
     PGUSER = "tu_usuario"     # Normalmente es "postgres"
     PGPASSWORD = "tu_clave"   # La que pusiste al instalar PostgreSQL
     PGHOST = "localhost"      # No cambiar
     PGPORT = "5432"          # No cambiar
```
3. **Crear las Tablas Necesarias**
   - Primero, tabla de cargos y insertar los cargos predeterminados:
   ```bash
   sql\tabla_cargos.sql
   sql\insertar_cargos.sql
   ```
   - Segundo, tabla de tipos de horas extra y insertar los tipos de hora extra predeterminados:
   ```bash
   sql\tabla_tipo_hora_extra.sql
   sql\insertar_tipo_de_horas_extra.sql
   ```
   - Tercero, tabla de empleados:
   ```bash
   sql\tabla_empleados.sql
   ```
   - Cuarto, tabla de horas extras:
   ```bash
   sql\tabla_horas_extra.sql
   ```
   - Quinto, tabla de pr√©stamos:
   ```bash
   sql\tabla_prestamo.sql
   ```
4. **Verificar la Configuraci√≥n**
- Ejecuta el programa
- Intenta registrar un empleado nuevo
- Si los datos se guardan correctamente, la configuraci√≥n est√° lista

### **Manual de usu** - **Sistema de Liquidaci√≥n de N√≥mina**
1. **Inicio del Programa**
- Ejecute el archivo SistemaNomina.exe
- Ubicado en:
```
dist\SistemaNomina.exe
```
- Se abrir√° una ventana principal con un men√∫ de 4 opciones principales

2. **Pantalla Principal**
La interfaz principal muestra cuatro botones principales:
  - Calcular N√≥mina
  - Modificar N√≥mina
  - Consultar N√≥mina
  - Borrar N√≥mina
    
3. **Calcular N√≥mina (Registrar Nuevo Empleado)**
- Haga clic en "Calcular N√≥mina"
- Complete los siguientes campos obligatorios:
    - C√©dula (entre 8 y 10 d√≠gitos)
    - Nombres (solo letras)
    - Apellidos (solo letras)
    - Cargo (seleccione: Empleado nuevo, Empleado antiguo o Administrador)
    - Salario Base (debe ser igual o mayor al salario m√≠nimo: $1.423.500)
- Campos opcionales:
    - Horas Extras (m√°ximo 50 horas mensuales en total)
    - Tipo de Hora Extra (Diurnas, Nocturnas o Festivas)
    - Horas Extras Adicionales
    - Tipo de Hora Extra Adicional
    - Pr√©stamo (si aplica)
    - N√∫mero de Cuotas (si hay pr√©stamo)
    - Tasa de Inter√©s (si hay pr√©stamo)
    - Al finalizar, haga clic en "Calcular"
    - El sistema mostrar√° el salario final calculado

4. **Modificar N√≥mina**
- Haga clic en "Modificar N√≥mina"
- Ingrese la c√©dula del empleado
- Modifique los campos necesarios:
  - Nombres y Apellidos
  - Cargo
  - Salario Base
  - Horas Extras
  - Pr√©stamos
- Haga clic en "Modificar" para guardar los cambios

5. **Consultar N√≥mina**
- Haga clic en "Consultar N√≥mina"
- Ingrese la c√©dula del empleado
- El sistema mostrar√°:
  - Datos personales del empleado
  - Informaci√≥n salarial
  - Horas extras registradas
  - Pr√©stamos activos

6. **Borrar N√≥mina**
- Haga clic en "Borrar N√≥mina"
- Ingrese la c√©dula del empleado
- Confirme la eliminaci√≥n
- El sistema eliminar√° todos los registros del empleado

Consideraciones Importantes:
- Validaciones del Sistema:
  - La c√©dula debe tener entre 8 y 10 d√≠gitos
  - Nombres y apellidos solo aceptan letras
  - El salario base no puede ser menor al m√≠nimo legal
  - El total de horas extras no puede superar 50 horas mensuales

- C√°lculos Autom√°ticos:
  - Bonificaciones seg√∫n el cargo
  - Valor de horas extras seg√∫n el tipo
  - Auxilio de transporte (para salarios hasta 2 SMLV)
  - Deducciones de ley (salud y pensi√≥n)
  - Cuotas de pr√©stamos con intereses
   
